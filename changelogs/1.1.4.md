# v1.1.4

> Release Date: January 2026

## ‚ú® New Features

### Key Path Information in Renewal Response

Added `newKeyPath` field to the key renewal response, providing direct access to the newly generated key's storage location:

```typescript
const { expired, ready, newKeyPath } = await keyManager.getKey({
  path: 'api',
  version: '1',
  onRotate: {
    duration: 7,
    unit: 'days',
  },
});

if (newKeyPath) {
  console.log(`New key stored at: ${newKeyPath}`);
  // Use for logging, auditing, or custom hook implementations
}
```

**Benefits:**
- Enhanced visibility into key storage locations during rotation
- Improved logging and auditing capabilities
- Better integration with custom hooks and monitoring systems
- Easier debugging and troubleshooting of key rotation processes

---

## üîß Improvements

### Enhanced TGetKey Type

Updated the `TGetKey` type to include the optional `newKeyPath` property:

```typescript
type TGetKey = {
  expired: TKeyGenerated | null;
  ready: TKeyGenerated | null;
  newKeyPath?: string;  // New: Path where the new key is stored
};
```

**When Available:**
- Only populated during key renewal/rotation
- Contains the full path where the newly generated key is stored
- `undefined` when no rotation occurs (key is still valid)

---

### Updated Key Renewal Implementation

Modified the key renewal process in `KeyManager.getKey()` to include the new key path:

**Before:**
```typescript
const resGetKey = { expired: key, ready: renew.key };
```

**After:**
```typescript
const resGetKey = {
  expired: key,
  ready: renew.key,
  newKeyPath: renew.path
};
```

**Impact:**
- All `onKeyRenewed` hooks now receive the new key path information
- Better context for custom hook implementations
- Improved traceability for key rotation events

---

## üìÅ Files Changed

- `src/types/key-manager.types.ts` - Added `newKeyPath` to `TGetKey` type
- `src/core/key-manager.core.ts` - Updated key renewal response to include new path

---

## üéØ Use Cases

### Enhanced Logging

```typescript
const { expired, ready, newKeyPath } = await keyManager.getKey({
  path: 'api/production',
  version: '2',
  onRotate: {
    duration: 30,
    unit: 'days',
  },
});

if (newKeyPath) {
  logger.info('Key rotation completed', {
    oldKey: expired?.hashed,
    newKey: ready?.hashed,
    storagePath: newKeyPath,
    timestamp: new Date().toISOString(),
  });
}
```

### Custom Monitoring and Alerting

```typescript
const result = await keyManager.getKey({
  path: 'api/critical-service',
  version: '1',
  onRotate: {
    duration: 1,
    unit: 'days',
  },
});

if (result.newKeyPath) {
  // Send alert to monitoring system
  await monitoringService.trackKeyRotation({
    service: 'critical-service',
    keyPath: result.newKeyPath,
    rotatedAt: Date.now(),
  });

  // Update distributed config
  await distributedConfig.updateKeyReference(result.newKeyPath);
}
```

### Audit Trail Implementation

```typescript
const { expired, ready, newKeyPath } = await keyManager.getKey({
  path: 'api/user-auth',
  version: '1',
  onRotate: {
    duration: 7,
    unit: 'days',
  },
});

if (newKeyPath) {
  // Create audit record
  await auditLog.record({
    action: 'KEY_ROTATION',
    resource: 'api/user-auth',
    oldKeyPath: expired ? `api/user-auth/v1` : null,
    newKeyPath: newKeyPath,
    timestamp: new Date(),
    automatic: true,
  });
}
```

---

## ‚¨ÜÔ∏è Migration Guide

### From v1.1.3 to v1.1.4

This is a **backward-compatible** release. No breaking changes.

#### Optional: Use New Path Information

```typescript
// Before v1.1.4
const { expired, ready } = await km.getKey({
  path: 'api',
  version: '1',
  onRotate: { duration: 7, unit: 'days' },
});

// After v1.1.4 - now includes newKeyPath
const { expired, ready, newKeyPath } = await km.getKey({
  path: 'api',
  version: '1',
  onRotate: { duration: 7, unit: 'days' },
});

if (newKeyPath) {
  // Access the new key's storage location
  console.log(`Key rotated to: ${newKeyPath}`);
}
```

#### TypeScript Users

If you're using TypeScript and have code that destructures `TGetKey`, this change is fully compatible:

```typescript
// Existing code still works
const { expired, ready } = await km.getKey(options);

// New code can access the path
const { expired, ready, newKeyPath } = await km.getKey(options);
```

---

## üìä Technical Details

### Type Safety

The `newKeyPath` field is properly typed as optional:
- TypeScript will not require you to handle this field
- It's only present during key rotation events
- Type inference works seamlessly

### Performance

No performance impact:
- Simple property addition to existing object
- No additional I/O operations
- No changes to core rotation logic

---

## üöÄ Summary

Version 1.1.4 enhances the key rotation experience by providing better visibility into where newly generated keys are stored. This small but impactful addition enables:

1. **Better Observability** - Track key storage locations during rotation
2. **Enhanced Logging** - Include path information in audit logs
3. **Improved Integration** - Easier integration with monitoring and alerting systems
4. **Backward Compatibility** - Fully compatible with existing implementations

This release maintains the library's commitment to production-ready key management while adding valuable metadata for enterprise use cases.

---

**Made with ‚ù§Ô∏è for secure key management**
