# v1.1.2

> Release Date: January 2026

## ‚ú® New Features

### Key Verification Method

Added a new `verifyKey()` method to verify hashed keys against stored keys:

```typescript
const isValid = await keyManager.verifyKey(hashedKey, path, version);
if (isValid) {
  console.log('Key is valid!');
} else {
  console.log('Key is invalid!');
}
```

**Features:**
- Verifies both expired and ready keys
- Supports secret-based verification using PBKDF2
- Automatically uses the most appropriate key (expired or ready)
- Optional hook disabling for clean verification logic
- Falls back to direct hash comparison when no secret is provided

**Verification Strategy:**
```typescript
// With secret (secure PBKDF2 verification)
if (key.secret) return this.cryptoService.verifyHash(key.key, hashedKey, key.secret);

// Without secret (direct comparison)
return hashedKey === key.hashed;
```

---

### Secret Field for Enhanced Security

Keys now include an optional `secret` field for enhanced security:

```typescript
type TKeyGenerated = {
  // ... existing fields
  secret?: string;  // New: Secret used to hash the key
}
```

**Benefits:**
- Enables PBKDF2-based key verification
- More secure than direct hash comparison
- Backward compatible with existing keys

---

### Hook Control

Added `disableHooks` option to `getKey()` method:

```typescript
const { ready, expired } = await keyManager.getKey({
  path: 'api',
  version: '1',
  disableHooks: true,  // Skip hook execution
});
```

**Use Cases:**
- Internal operations that don't require hooks
- Performance optimization for bulk operations
- Preventing recursive hook calls
- Testing and debugging

---

## üîß Improvements

### Enhanced Type System

Added new optional type validators in `string.util.ts`:

```typescript
isType(data) // Now returns:
{
  // ... existing validators
  optionalString: boolean,      // undefined or string
  optionalNumber: boolean,      // undefined or number
  optionalStringNumber: boolean // undefined or string/number
}
```

**Usage:**
```typescript
const typeChecks = {
  secret: 'optionalString',  // Now validates correctly
};
```

---

### Improved Error Handling

Modified `getKey()` behavior when key is expired and `onRotate` is missing:

**Before:**
```typescript
// Returned null for both expired and ready
return { expired: null, ready: null };
```

**After:**
```typescript
// Returns the expired key so it can still be verified
return { expired: key, ready: null };
```

**Benefits:**
- Allows verification of expired keys
- Better debugging experience
- More predictable behavior

---

### Hook Execution Control

All hooks in `getKey()` now respect the `disableHooks` option:

```typescript
// Before (always executed)
this.runKeyHook('onKeyNotFound', path, version);

// After (respects disableHooks)
if (!options.disableHooks) this.runKeyHook('onKeyNotFound', path, version);
```

**Affected Hooks:**
- `onKeyNotFound`
- `onKeyMissingRotateOption`
- `onKeyRenewed`
- `onKeyExpired`
- `onKeyInvalid`

---

## üìù Documentation

### Enhanced README

**Added:**
- More detailed package description highlighting key features
- "Zero Dependencies" and "Production Ready" feature badges
- Direct npm package link
- Expanded use cases with detailed descriptions:
  - API Key Management
  - Token Rotation (OAuth, JWT, access tokens)
  - Secret Management
  - Multi-Version Keys (rotation periods)
  - Custom Persistence (databases, cloud storage, KMS)
  - Backend Services (microservices)
  - Encryption Keys
  - Session Keys
  - Database Credentials
  - Service-to-Service Authentication
- New "Search Keywords" section for better discoverability

---

### Enhanced package.json Metadata

**Description Updated:**
```json
// Before
"description": "Simple, secure key rotation for Node.js"

// After
"description": "Production-ready cryptographic key management library for Node.js with automatic rotation, expiration, versioning, and flexible storage. Supports AES-256-CBC encryption, PBKDF2 key derivation, file-based storage, custom hooks, and TypeScript."
```

**Keywords Expanded:**
```json
// Before
"keywords": ["typescript", "module"]

// After
"keywords": [
  "key-rotation",
  "key-management",
  "secret-management",
  "api-key-rotation",
  "credential-management",
  "encryption",
  "cryptography",
  "typescript",
  "nodejs"
]
```

**Repository Information Added:**
```json
"repository": {
  "type": "git",
  "url": "https://github.com/DucAnh2611/key-rotation-manager.git"
},
"homepage": "https://github.com/DucAnh2611/key-rotation-manager#readme",
"bugs": {
  "url": "https://github.com/DucAnh2611/key-rotation-manager/issues"
}
```

---

## üìã API Changes

### New Method

```typescript
class KeyManager {
  verifyKey(
    hashedKey: string,
    path: string,
    version: string | number,
    disableGetKeyHooks?: boolean
  ): Promise<boolean>
}
```

### Updated Types

```typescript
// TGetKeyOptions
type TGetKeyOptions = {
  path: string;
  version: string;
  disableHooks?: boolean;  // New option
  onRotate?: // ... existing
};

// TKeyGenerated
type TKeyGenerated = {
  // ... existing fields
  secret?: string;  // New field
};
```

---

## üîÑ Behavior Changes

### getKey() Return Value

When a key is expired and `onRotate` is not provided:

| Scenario | Before | After |
|----------|--------|-------|
| Expired key, no rotation | `{ expired: null, ready: null }` | `{ expired: key, ready: null }` |
| Key not found | `{ expired: null, ready: null }` | `{ expired: null, ready: null }` |
| Valid key | `{ expired: null, ready: key }` | `{ expired: null, ready: key }` |

**Benefits:**
- Expired keys can still be verified
- Better error handling and debugging
- More informative return values

---

## üìÅ Files Changed

- `src/core/key-manager.core.ts` - Added `verifyKey()`, hook control, secret field support
- `src/types/key-manager.types.ts` - Added `disableHooks` and `secret` fields
- `src/utils/string.util.ts` - Enhanced type validators, added return type
- `README.md` - Enhanced documentation, use cases, and search keywords
- `package.json` - Improved metadata, keywords, and repository information

---

## üéØ Use Cases for New Features

### Key Verification in Authentication

```typescript
// API key verification
app.post('/api/verify', async (req, res) => {
  const { apiKey, keyId, version } = req.body;

  const isValid = await keyManager.verifyKey(apiKey, keyId, version);

  if (isValid) {
    res.json({ message: 'Authentication successful' });
  } else {
    res.status(401).json({ error: 'Invalid credentials' });
  }
});
```

### Bulk Operations with Disabled Hooks

```typescript
// Check multiple keys without triggering hooks
async function verifyBulkKeys(keys: Array<{ hash: string, path: string, version: string }>) {
  const results = await Promise.all(
    keys.map(async ({ hash, path, version }) => {
      const { ready, expired } = await keyManager.getKey({
        path,
        version,
        disableHooks: true,  // Skip hooks for performance
      });

      return keyManager.verifyKey(hash, path, version, true);
    })
  );

  return results;
}
```

---

## üìä NPM Package Improvements

This release focuses on improving package discoverability and developer experience:

1. **Better Search Rankings** - Enhanced keywords and description
2. **Complete Metadata** - Added repository, homepage, and bug tracking
3. **Clearer Value Proposition** - Detailed feature description
4. **Professional Documentation** - Comprehensive use cases and examples

---

## ‚¨ÜÔ∏è Migration Guide

### From v1.1.1 to v1.1.2

This is a **backward-compatible** release. No breaking changes.

#### Optional: Use New Features

```typescript
// 1. Enable key verification
const isValid = await km.verifyKey(hashedKey, 'api', '1');

// 2. Disable hooks when not needed
const { ready } = await km.getKey({
  path: 'api',
  version: '1',
  disableHooks: true,
});

// 3. Access expired keys even without rotation
const { expired, ready } = await km.getKey({
  path: 'api',
  version: '1',
  // No onRotate needed - expired key still returned
});
```

---

## üöÄ Performance Improvements

- Hook execution can now be disabled for performance-critical operations
- Reduced unnecessary hook calls in verification scenarios
- More efficient bulk key operations

---

## üìà Package Statistics

- **Bundle Size:** No change from v1.1.1
- **Dependencies:** Still zero runtime dependencies
- **TypeScript:** Full type safety maintained
- **Node.js:** >= 18.0.0 (unchanged)

---

## üîç SEO and Discoverability

This release significantly improves package discoverability through:

- **10 targeted keywords** for npm search
- **Comprehensive description** highlighting all features
- **Search keywords section** in README for better SEO
- **GitHub integration** for community engagement

**Search Terms Now Supported:**
- key rotation
- key management
- cryptographic key storage
- API key rotation
- secret rotation
- credential management
- token rotation
- key versioning
- automatic key rotation
- secure key storage
- Node.js key management
- TypeScript key management
- production key rotation
- enterprise key management

---

## üéâ Summary

Version 1.1.2 focuses on three main areas:

1. **New Capabilities** - Key verification method for authentication use cases
2. **Developer Experience** - Hook control and better error handling
3. **Package Visibility** - Enhanced npm metadata and documentation

This release maintains 100% backward compatibility while adding powerful new features for production applications.

---

**Made with ‚ù§Ô∏è for secure key management**
